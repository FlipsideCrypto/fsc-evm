version: 2

models:
  # =============================================================================
  # Cross-Chain Models (work across all chains via GLOBAL_PROJECT_NAME)
  # =============================================================================

  - name: silver_protocols__aave_flashloan_fees
    description: >
      Aave flashloan fees aggregated by date, chain, protocol, and token.
      Tracks premium amounts paid on flashloans for both V2 and V3 deployments.
      Works across all chains - uses GLOBAL_PROJECT_NAME for chain identification.
      V2 chains: ethereum, polygon, avalanche
      V3 chains: ethereum, polygon, avalanche, arbitrum, optimism, base, gnosis
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - date
            - protocol
            - token_address
    columns:
      - name: date
        tests:
          - not_null
      - name: chain
        tests:
          - not_null
      - name: protocol
        tests:
          - not_null
      - name: token_address
        tests:
          - not_null
      - name: amount_nominal
        tests:
          - not_null
      - name: modified_timestamp
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__aave_liquidation_revenue
    description: >
      Aave liquidation revenue from LiquidationCall events.
      Captures individual liquidation events with collateral and debt details.
      Works across all chains - uses GLOBAL_PROJECT_NAME for chain identification.
      V2 chains: ethereum, polygon, avalanche
      V3 chains: ethereum, polygon, avalanche, arbitrum, optimism, base, gnosis, bsc
    columns:
      - name: _log_id
        tests:
          - not_null
          - unique
      - name: date
        tests:
          - not_null
      - name: chain
        tests:
          - not_null
      - name: protocol
        tests:
          - not_null
      - name: modified_timestamp
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__aave_reserve_factor_revenue
    description: >
      Aave reserve factor revenue from ReserveDataUpdated events.
      Tracks amounts transferred to protocol treasury via reserve factor.
      Works across all chains - uses GLOBAL_PROJECT_NAME for chain identification.
      V2 chains: ethereum, polygon, avalanche
      V3 chains: ethereum, polygon, avalanche, arbitrum, optimism, base, gnosis, bsc
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - date
            - protocol
            - token_address
    columns:
      - name: date
        tests:
          - not_null
      - name: chain
        tests:
          - not_null
      - name: protocol
        tests:
          - not_null
      - name: token_address
        tests:
          - not_null
      - name: amount_nominal
        tests:
          - not_null
      - name: modified_timestamp
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__aave_ecosystem_incentives
    description: >
      Aave ecosystem incentives from RewardsClaimed events.
      Tracks liquidity mining rewards distributed to users.
      Works across all chains - uses GLOBAL_PROJECT_NAME for chain identification.
      V2 chains: ethereum, polygon, avalanche
      V3 chains: ethereum, polygon, avalanche, arbitrum, optimism, base, gnosis, bsc
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - date
            - protocol
            - token_address
    columns:
      - name: date
        tests:
          - not_null
      - name: chain
        tests:
          - not_null
      - name: protocol
        tests:
          - not_null
      - name: token_address
        tests:
          - not_null
      - name: amount_nominal
        tests:
          - not_null
      - name: modified_timestamp
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__aave_deposits_borrows_lender_revenue
    description: >
      Aave deposits, borrows, and lender revenue metrics.
      Tracks daily borrow rates, liquidity rates, and reserve factors.
      Works across all chains - uses GLOBAL_PROJECT_NAME for chain identification.
      V2 chains: ethereum, polygon, avalanche
      V3 chains: ethereum, polygon, avalanche, arbitrum, optimism, base, gnosis, bsc
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - date
            - protocol
            - token_address
    columns:
      - name: date
        tests:
          - not_null
      - name: chain
        tests:
          - not_null
      - name: protocol
        tests:
          - not_null
      - name: token_address
        tests:
          - not_null
      - name: daily_borrow_rate
      - name: daily_liquidity_rate
      - name: stable_borrow_rate
      - name: reserve_factor
      - name: modified_timestamp
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  # =============================================================================
  # Ethereum-Only Models (DAO, treasury, and governance specific)
  # =============================================================================

  - name: silver_protocols__aave_dao_balancer_trading_fees
    description: >
      Aave DAO Balancer pool trading fees.
      Tracks fees earned from the AAVE/WETH 80/20 pool.
      Ethereum-only model.
    columns:
      - name: date
        tests:
          - not_null
          - unique
      - name: chain
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__aave_dao_safety_incentives
    description: >
      Aave DAO safety module incentives.
      Tracks staked AAVE rewards distributed to safety module stakers.
      Ethereum-only model.
    columns:
      - name: date
        tests:
          - not_null
          - unique
      - name: chain
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__aave_gho_treasury_revenue
    description: >
      Aave GHO treasury revenue.
      Tracks interest revenue from GHO stablecoin borrowing.
      Ethereum-only model.
    columns:
      - name: date
        tests:
          - not_null
          - unique
      - name: chain
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__aave_aavura_treasury
    description: >
      Aave Aavura treasury balances.
      Tracks token holdings in the Aavura treasury multisig.
      Ethereum-only model.
    columns:
      - name: date
        tests:
          - not_null
          - unique
      - name: chain
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__aave_ecosystem_reserve
    description: >
      Aave ecosystem reserve balances.
      Tracks AAVE holdings in the ecosystem reserve contract.
      Ethereum-only model.
    columns:
      - name: date
        tests:
          - not_null
          - unique
      - name: chain
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__aave_safety_module
    description: >
      Aave safety module staked token supply.
      Tracks total supply of stkAAVE, stkABPT, and stkGHO.
      Ethereum-only model.
    columns:
      - name: date
        tests:
          - not_null
          - unique
      - name: chain
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__aave_v2_collector
    description: >
      Aave V2 collector treasury balances.
      Tracks token holdings in the V2 collector contract.
      Ethereum-only model.
    columns:
      - name: date
        tests:
          - not_null
          - unique
      - name: chain
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null
