version: 2

models:
  # =============================================================================
  # Cross-Chain Models (work across all chains via GLOBAL_PROJECT_NAME)
  # =============================================================================

  - name: silver_protocols__chainlink_ocr_rewards_daily
    description: >
      Daily Chainlink OCR (Off-Chain Reporting) rewards by operator.
      Aggregates token transfers from OCR transmission events.
      Works across all chains - uses GLOBAL_PROJECT_NAME for chain identification.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - date
            - operator_address
            - token_address
    columns:
      - name: date
        tests:
          - not_null
      - name: chain
        tests:
          - not_null
      - name: operator_address
        tests:
          - not_null
      - name: token_address
        tests:
          - not_null
      - name: reward_amount
        tests:
          - not_null
      - name: modified_timestamp
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__chainlink_fm_rewards_daily
    description: >
      Daily Chainlink Flux Monitor (FM) rewards by operator.
      FM is used for price feed submissions.
      Works across all chains - uses GLOBAL_PROJECT_NAME for chain identification.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - date
            - operator_address
            - token_address
    columns:
      - name: date
        tests:
          - not_null
      - name: chain
        tests:
          - not_null
      - name: operator_address
        tests:
          - not_null
      - name: token_address
        tests:
          - not_null
      - name: reward_amount
        tests:
          - not_null
      - name: modified_timestamp
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__chainlink_direct_rewards_daily
    description: >
      Daily Chainlink direct operator rewards.
      Direct payments to operators for node operations.
      Works across all chains - uses GLOBAL_PROJECT_NAME for chain identification.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - date
            - operator_address
            - token_address
    columns:
      - name: date
        tests:
          - not_null
      - name: chain
        tests:
          - not_null
      - name: operator_address
        tests:
          - not_null
      - name: token_address
        tests:
          - not_null
      - name: reward_amount
        tests:
          - not_null
      - name: modified_timestamp
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__chainlink_ocr_transmission_logs
    description: >
      Chainlink OCR (Off-Chain Reporting) transmission event logs.
      Raw event data from OCR transmissions.
      Works across all chains - uses GLOBAL_PROJECT_NAME for chain identification.
    columns:
      - name: _log_id
        tests:
          - not_null
          - unique
      - name: block_timestamp
        tests:
          - not_null
      - name: chain
        tests:
          - not_null
      - name: modified_timestamp
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__chainlink_vrf_request_fulfilled_logs
    description: >
      Chainlink VRF (Verifiable Random Function) request fulfilled logs.
      Captures randomness request and fulfillment events.
      Works across all chains - uses GLOBAL_PROJECT_NAME for chain identification.
    columns:
      - name: _log_id
        tests:
          - not_null
          - unique
      - name: block_timestamp
        tests:
          - not_null
      - name: chain
        tests:
          - not_null
      - name: modified_timestamp
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__chainlink_ccip_send_requested_logs_v1
    description: >
      Chainlink CCIP (Cross-Chain Interoperability Protocol) v1 send requested logs.
      Captures cross-chain message send requests.
      Works across all chains - uses GLOBAL_PROJECT_NAME for chain identification.
    columns:
      - name: _log_id
        tests:
          - not_null
          - unique
      - name: block_timestamp
        tests:
          - not_null
      - name: chain
        tests:
          - not_null
      - name: modified_timestamp
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__chainlink_ccip_send_requested_logs_v1_2
    description: >
      Chainlink CCIP (Cross-Chain Interoperability Protocol) v1.2 send requested logs.
      Captures cross-chain message send requests (updated format).
      Works across all chains - uses GLOBAL_PROJECT_NAME for chain identification.
    columns:
      - name: _log_id
        tests:
          - not_null
          - unique
      - name: block_timestamp
        tests:
          - not_null
      - name: chain
        tests:
          - not_null
      - name: modified_timestamp
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__chainlink_automation_upkeep_performed_logs
    description: >
      Chainlink Automation (formerly Keepers) upkeep performed logs.
      Captures automated task execution events.
      Works across all chains - uses GLOBAL_PROJECT_NAME for chain identification.
    columns:
      - name: _log_id
        tests:
          - not_null
          - unique
      - name: block_timestamp
        tests:
          - not_null
      - name: chain
        tests:
          - not_null
      - name: modified_timestamp
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  # =============================================================================
  # Chain-Specific Models (Ethereum-only or special cases)
  # =============================================================================

  - name: silver_protocols__chainlink_ethereum_staking_rewards
    description: >
      Chainlink staking rewards on Ethereum.
      Tracks rewards from both V1 (RewardClaimed) and V2 (RewardsVault) staking contracts.
      Ethereum-only model.
    columns:
      - name: date
        tests:
          - not_null
          - unique
      - name: chain
        tests:
          - not_null
      - name: staking_rewards_native
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__chainlink_treasury_native_usd
    description: >
      Chainlink Treasury balance in LINK and USD.
      Tracks cumulative balance in non-circulating supply addresses.
      Ethereum-centric model (LINK token and treasury addresses are Ethereum mainnet).
    columns:
      - name: date
        tests:
          - not_null
          - unique
      - name: treasury_link
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__chainlink_tvl_native_usd
    description: >
      Chainlink Total Value Locked (TVL) in LINK and USD.
      Tracks balances in key staking contracts.
      Ethereum-centric model (staking contracts are on Ethereum mainnet).
    columns:
      - name: date
        tests:
          - not_null
          - unique
      - name: balance_link
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null

  - name: silver_protocols__chainlink_polygon_ocr_reconcile_daily
    description: >
      Chainlink Polygon OCR reconciliation data.
      Contains historical reconciliation adjustments for operator payments from October 2023.
      Polygon-only model.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - date_start
            - admin_address
    columns:
      - name: date_start
        tests:
          - not_null
      - name: admin_address
        tests:
          - not_null
      - name: inserted_timestamp
        tests:
          - not_null
      - name: _invocation_id
        tests:
          - not_null
